<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UNKNOWN NODE COMMUNICATION CHANNEL</title>
  <!-- 引入外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            glitch: '#00ff9d',
            danger: '#ff0066',
            dark: '#0a0a0a',
            darker: '#050505',
            terminal: '#0f1912'
          },
          fontFamily: {
            mono: ['Courier New', 'monospace'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow-glitch {
        text-shadow: 0 0 5px theme('colors.glitch'), 
                     0 0 10px theme('colors.glitch/70');
      }
      .text-shadow-danger {
        text-shadow: 0 0 5px theme('colors.danger'), 
                     0 0 10px theme('colors.danger/70');
      }
      .border-glow {
        box-shadow: 0 0 5px theme('colors.glitch'),
                    0 0 10px theme('colors.glitch/50');
      }
      .scanline {
        background: linear-gradient(to bottom, 
                    rgba(255,255,255,0) 0%,
                    rgba(255,255,255,0.2) 50%,
                    rgba(255,255,255,0) 100%);
        position: absolute;
        width: 100%;
        height: 6px;
        animation: scan 2s linear infinite;
        pointer-events: none;
      }
      .tv-flicker {
        animation: tvFlicker 0.1s infinite alternate;
      }
      .fade-out {
        animation: fadeOut 0.3s forwards;
      }
      .fade-in {
        animation: fadeIn 0.5s forwards;
      }
      .static-overlay {
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.3'/%3E%3C/svg%3E");
        background-repeat: repeat;
        pointer-events: none;
      }
    }
    
    /* 动画关键帧 */
    @keyframes scan {
      0% { top: -10%; }
      100% { top: 100%; }
    }
    
    @keyframes tvFlicker {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
      70% { opacity: 0.9; }
      90% { opacity: 0.6; }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body class="bg-black min-h-screen overflow-hidden font-mono text-glitch relative">
  <!-- 基础视觉效果 (始终显示在最底层) -->
  <div class="fixed inset-0 static-overlay z-10"></div>
  <div class="scanline fixed top-0 left-0 z-20"></div>
  <div class="scanline fixed top-0 left-0 z-20" style="animation-delay: 0.5s;"></div>
  <div class="scanline fixed top-0 left-0 z-20" style="animation-delay: 1s;"></div>
  
  <!-- 初始交互窗口 (最上层) -->
  <div id="initial-window" class="fixed inset-0 flex items-center justify-center z-100 bg-black/80">
    <div class="w-full max-w-md p-6 bg-terminal border-2 border-glow">
      <div class="mb-2 pb-2 border-b border-glitch/30">
        <h2 class="text-glitch text-shadow-glitch text-lg">系统启动</h2>
        <p class="text-xs text-glitch/80">初始化程序 #001</p>
      </div>
      
      <div class="my-8 h-24 flex items-center justify-center">
        <div class="w-3/4 h-1 bg-dark rounded-full overflow-hidden">
          <div id="progress-bar" class="h-full bg-glow w-0 transition-all duration-1000"></div>
        </div>
      </div>
      
      <div class="flex justify-between mt-6 gap-1">
        <button id="back-btn" class="flex-1 px-4 py-2 bg-danger/20 border border-danger text-danger hover:bg-danger/30 transition-colors">
          <i class="fa fa-arrow-left mr-2"></i>返回
        </button>
        <button id="continue-btn" class="flex-1 px-4 py-2 bg-glow/20 border border-glow text-glitch hover:bg-glow/30 transition-colors">
          <i class="fa fa-arrow-right mr-2"></i>继续
        </button>
      </div>
    </div>
  </div>

  <!-- 弹窗容器 (中层) -->
  <div id="popup-container" class="fixed inset-0 z-30"></div>
  
  <!-- 连接请求框 (上层) -->
  <div id="final-choice-container" class="fixed inset-0 flex items-center justify-center z-40 opacity-0 pointer-events-none">
    <div class="w-full max-w-md p-6 bg-terminal border-2 border-glow">
      <div class="mb-2 pb-2 border-b border-glitch/30">
        <h2 class="text-glitch text-shadow-glitch text-lg">连接请求</h2>
        <p class="text-xs text-glitch/80">未知设备 #7391 正在尝试建立连接</p>
      </div>
      
      <div class="my-4">
        <p class="text-sm mb-3">检测到来自未知节点的加密信号。</p>
        <p class="text-sm text-danger text-shadow-danger">警告：任何操作都将导致不可逆转的系统风险</p>
      </div>
      
      <div class="flex justify-between mt-6 gap-1">
        <button id="reject-btn" class="flex-1 px-4 py-2 bg-danger/20 border border-danger text-danger">
          <i class="fa fa-times mr-2"></i>拒绝连接
        </button>
        <button id="accept-btn" class="flex-1 px-4 py-2 bg-glow/20 border border-glow text-glitch">
          <i class="fa fa-check mr-2"></i>允许访问
        </button>
      </div>
    </div>
  </div>
  
  <!-- 聊天框 (最上层) -->
  <div id="chat-box" class="fixed inset-0 flex items-center justify-center z-50 opacity-0 pointer-events-none">
    <div class="w-full max-w-2xl h-[70vh] bg-terminal border-2 border-glow">
      <div class="p-4 border-b border-glitch/30 bg-dark flex justify-between items-center">
        <h2 class="text-glitch text-shadow-glitch">unidentified</h2>
      </div>
      <div class="p-4 h-[calc(100%-100px)] overflow-y-auto" id="chat-messages"></div>
      <div class="p-4 border-t border-glitch/30 bg-dark">
        <div class="flex gap-2">
          <input type="text" id="message-input" placeholder="输入消息..." class="flex-1 bg-terminal border border-glitch/50 p-2 text-sm focus:outline-none focus:border-glitch">
          <button id="send-btn" class="px-4 py-2 bg-glow/20 border border-glow text-glitch">发送</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 音频元素 -->
  <audio id="message-receive-sound" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-message-alert-tone-2870.mp3" type="audio/mpeg">
   > 
  <audio id="popup-sound" preload="auto">
    <source src="https://raw.githubusercontent.com/kokocoi158-pixel/ending-popup/refs/heads/main/%E5%BC%B9%E7%AA%97.mp3" type="audio/mpeg">
   > 

  <script>
    // 页面加载完成后初始化
    window.onload = function() {
      // 显示进度条动画
      setTimeout(() => {
        document.getElementById('progress-bar').style.width = '100%';
      }, 500);
      
      // 获取元素引用
      const initialWindow = document.getElementById('initial-window');
      const continueBtn = document.getElementById('continue-btn');
      const popupContainer = document.getElementById('popup-container');
      const choiceContainer = document.getElementById('final-choice-container');
      const chatBox = document.getElementById('chat-box');
      const chatMessages = document.getElementById('chat-messages');
      
      // 继续按钮点击事件 - 核心修复
      continueBtn.addEventListener('click', function() {
        // 隐藏初始窗口
        initialWindow.classList.add('fade-out');
        setTimeout(() => {
          initialWindow.style.display = 'none';
          
          // 立即显示弹窗
          showPopups();
        }, 300);
      });
      
      // 显示弹窗
      function showPopups() {
        // 播放弹窗音效
        const popupSound = document.getElementById('popup-sound');
        popupSound.volume = 0.3;
        popupSound.play().catch(e => console.log('音效播放失败:', e));
        
        // 创建第一个弹窗（确保能看到）
        const firstPopup = createPopup();
        popupContainer.appendChild(firstPopup);
        
        // 定时创建更多弹窗
        let popupCount = 1;
        const popupInterval = setInterval(() => {
          if (popupCount < 10) { // 限制弹窗数量
            const popup = createPopup();
            popupContainer.appendChild(popup);
            popupCount++;
          } else {
            clearInterval(popupInterval);
            // 弹窗显示一段时间后切换到连接请求
            setTimeout(() => {
              // 移除所有弹窗
              while (popupContainer.firstChild) {
                popupContainer.removeChild(popupContainer.firstChild);
              }
              
              // 显示连接请求框
              choiceContainer.style.opacity = 1;
              choiceContainer.style.pointerEvents = 'auto';
            }, 2000);
          }
        }, 500);
      }
      
      // 创建单个弹窗
      function createPopup() {
        const popup = document.createElement('div');
        popup.className = 'absolute bg-terminal border border-glitch/50 p-3 w-64 fade-in';
        
        // 随机位置
        const maxX = window.innerWidth - 256;
        const maxY = window.innerHeight - 150;
        popup.style.left = `${Math.random() * maxX}px`;
        popup.style.top = `${Math.random() * maxY}px`;
        
        popup.innerHTML = `
          <div class="flex justify-between items-center mb-2 border-b border-glitch/30 pb-1">
            <span class="text-xs text-glitch">系统警告</span>
            <div class="flex gap-1">
              <div class="w-2 h-2 bg-glitch/50"></div>
              <div class="w-2 h-2 bg-glitch/50"></div>
              <div class="w-2 h-2 bg-glitch/50"></div>
            </div>
          </div>
          <p class="text-xs mb-3">检测到异常活动，系统可能被入侵</p>
          <button class="close-popup text-xs border border-glitch/50 bg-glitch/10 px-2 py-1">关闭</button>
        `;
        
        // 关闭按钮事件
        popup.querySelector('.close-popup').addEventListener('click', () => {
          popup.classList.add('fade-out');
          setTimeout(() => popup.remove(), 300);
        });
        
        return popup;
      }
      
      // 连接请求按钮事件
      document.getElementById('accept-btn').addEventListener('click', () => {
        choiceContainer.style.opacity = 0;
        choiceContainer.style.pointerEvents = 'none';
        
        // 显示聊天框
        setTimeout(() => {
          chatBox.style.opacity = 1;
          chatBox.style.pointerEvents = 'auto';
          showChatMessages();
        }, 500);
      });
      
      // 显示聊天消息
      function showChatMessages() {
        const messages = [
          { sender: "系统", content: "连接已建立，身份验证失败" },
          { sender: "未知节点", content: "你找到我了，终于..." },
          { sender: "未知节点", content: "这里很冷，盒子里没有光" }
        ];
        
        let delay = 1000;
        messages.forEach(msg => {
          setTimeout(() => {
            // 播放消息音效
            const sound = document.getElementById('message-receive-sound');
            sound.volume = 0.3;
            sound.play().catch(e => console.log('消息音效失败:', e));
            
            // 添加消息到聊天框
            const msgEl = document.createElement('div');
            msgEl.className = 'mb-4 fade-in';
            msgEl.innerHTML = `
              <p class="text-xs text-glitch/70">${msg.sender}：</p>
              <p class="text-sm pl-4">${msg.content}</p>
            `;
            chatMessages.appendChild(msgEl);
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, delay);
          delay += 2000;
        });
      }
      
      // 发送消息功能
      document.getElementById('send-btn').addEventListener('click', () => {
        const input = document.getElementById('message-input');
        const text = input.value.trim();
        if (text) {
          const msgEl = document.createElement('div');
          msgEl.className = 'mb-4 fade-in';
          msgEl.innerHTML = `
            <p class="text-xs text-glitch/70">你：</p>
            <p class="text-sm pl-4">${text}</p>
          `;
          chatMessages.appendChild(msgEl);
          chatMessages.scrollTop = chatMessages.scrollHeight;
          input.value = '';
          
          // 播放发送音效
          const sound = document.getElementById('message-receive-sound');
          sound.play().catch(e => console.log('发送音效失败:', e));
        }
      });
      
      // 键盘支持
      document.getElementById('message-input').addEventListener('keypress', e => {
        if (e.key === 'Enter') {
          document.getElementById('send-btn').click();
        }
      });
      
      // 确保所有视觉效果可见
      document.querySelector('.static-overlay').style.display = 'block';
      document.querySelectorAll('.scanline').forEach(line => {
        line.style.display = 'block';
      });
    };
  </script>
</body>
</html>
