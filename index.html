<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>悬疑风格弹窗效果</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            glitch: '#00ff9d',
            danger: '#ff0066',
            dark: '#0a0a0a',
            terminal: '#0f1912'
          },
          fontFamily: {
            mono: ['Courier New', 'monospace'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow-glitch {
        text-shadow: 0 0 5px theme('colors.glitch'), 0 0 10px theme('colors.glitch/70');
      }
      .text-shadow-danger {
        text-shadow: 0 0 5px theme('colors.danger'), 0 0 10px theme('colors.danger/70');
      }
      .border-glow {
        box-shadow: 0 0 5px theme('colors.glitch'), 0 0 10px theme('colors.glitch/50');
      }
      .scanline {
        background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0) 100%);
        position: absolute;
        width: 100%;
        height: 6px;
        animation: scan 2s linear infinite;
      }
      .tv-flicker {
        animation: tvFlicker 0.1s infinite alternate;
      }
      .fade-out {
        animation: fadeOut 0.3s forwards;
      }
      .crt-shutdown {
        animation: crtShutdown 1.8s forwards;
      }
      .fade-in {
        animation: fadeIn 0.5s forwards;
      }
      .pulse-soft {
        animation: pulseSoft 2s infinite alternate;
      }
      .breath-effect {
        animation: breath 2s infinite alternate;
      }
      .static-overlay {
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.3'/%3E%3C/svg%3E");
        background-repeat: repeat;
      }
      .button-shake {
        animation: buttonShake 0.5s cubic-bezier(.36,.07,.19,.97) both;
      }
      .text-fade-in {
        animation: textFadeIn 0.5s forwards;
      }
      .message-appear {
        animation: messageAppear 0.6s forwards;
      }
      .non-interactive {
        pointer-events: none;
        opacity: 0.5;
      }
    }
    
    @keyframes scan { 0% { top: -10%; } 100% { top: 100%; } }
    @keyframes tvFlicker { 0%,100% { opacity:1; } 50% { opacity:.7; } 70% { opacity:.9; } 90% { opacity:.6; } }
    @keyframes fadeOut { from { opacity:1; transform:scale(1); } to { opacity:0; transform:scale(0.8); } }
    @keyframes crtShutdown { 0% { opacity:1; transform:scale(1); filter:brightness(1); } 50% { opacity:.8; filter:brightness(1.2); } 100% { opacity:0; transform:scale(0.95); filter:brightness(0) blur(2px); } }
    @keyframes fadeIn { from { opacity:0; transform:scale(0.9); } to { opacity:1; transform:scale(1); } }
    @keyframes pulseSoft { from { box-shadow:0 0 10px theme('colors.glitch/50'); } to { box-shadow:0 0 20px theme('colors.glitch/80'); } }
    @keyframes breath { from { opacity:.6; text-shadow:0 0 5px theme('colors.danger/50'); } to { opacity:1; text-shadow:0 0 10px theme('colors.danger'); } }
    @keyframes buttonShake { 10%,90% { transform:translateX(-1px); } 20%,80% { transform:translateX(2px); } 30%,50%,70% { transform:translateX(-3px); } 40%,60% { transform:translateX(3px); } }
    @keyframes textFadeIn { from { opacity:0; transform:translateY(5px); } to { opacity:1; transform:translateY(0); } }
    @keyframes messageAppear { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
  </style>
</head>
<body class="bg-black min-h-screen overflow-hidden font-mono text-glitch relative">
  <!-- 初始交互窗口 - 放在最前面确保能被点击 -->
  <div id="initial-window" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; z-index: 9999; pointer-events: auto;">
    <div style="width: 100%; max-width: 300px; padding: 1rem; background-color: #0f1912; border: 2px solid #00ff9d; box-shadow: 0 0 5px #00ff9d, 0 0 10px rgba(0,255,157,0.5); animation: pulseSoft 2s infinite alternate;">
      <div style="background-color: #0a0a0a; padding: 0.5rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(0,255,157,0.3); margin-bottom: 1rem;">
        <span style="color: #00ff9d; text-shadow: 0 0 5px #00ff9d, 0 0 10px rgba(0,255,157,0.7); font-size: 0.75rem;">初始化</span>
        <div style="display: flex; gap: 4px;">
          <div style="width: 6px; height: 6px; border-radius: 50%; background-color: rgba(0,255,157,0.5);"></div>
          <div style="width: 6px; height: 6px; border-radius: 50%; background-color: rgba(0,255,157,0.5);"></div>
          <div style="width: 6px; height: 6px; border-radius: 50%; background-color: rgba(0,255,157,0.5);"></div>
        </div>
      </div>
      
      <!-- 留白区域 -->
      <div style="min-height: 100px; margin-bottom: 1rem;"></div>
      
      <div style="display: flex; gap: 0.5rem;">
        <button id="back-btn" style="flex: 1; padding: 0.5rem; background-color: #0a0a0a; border: 1px solid rgba(0,255,157,0.3); color: #00ff9d; font-size: 0.75rem; pointer-events: none; opacity: 0.5;">
          <i class="fa fa-arrow-left mr-1"></i>返回
        </button>
        <button id="continue-btn" style="flex: 1; padding: 0.5rem; background-color: rgba(0,255,157,0.2); border: 1px solid rgba(0,255,157,0.5); color: #00ff9d; font-size: 0.75rem; cursor: pointer;">
          <i class="fa fa-arrow-right mr-1"></i>继续
        </button>
      </div>
    </div>
  </div>

  <!-- 音效元素 - 使用您的GitHub音频链接 -->
  <audio id="popup-sound" preload="auto">
    <source src="https://raw.githubusercontent.com/kokocoi158-pixel/ending-popup/refs/heads/main/tanchu.mp3" type="audio/mpeg">
  </audio>
  
  <!-- 多重扫描线效果 -->
  <div class="scanline"></div>
  <div class="scanline" style="animation-delay: 0.5s;"></div>
  <div class="scanline" style="animation-delay: 1s;"></div>
  
  <!-- 增强的无信号噪点效果 -->
  <div class="fixed inset-0 static-overlay pointer-events-none tv-flicker"></div>
  <div class="fixed inset-0 bg-gradient-to-b from-black/30 via-transparent to-black/60 pointer-events-none"></div>
  
  <!-- 弹窗容器 -->
  <div id="popup-container" class="relative w-full h-screen"></div>
  
  <!-- CRT关闭效果覆盖层 (初始隐藏) -->
  <div id="crt-overlay" class="fixed inset-0 bg-black opacity-0 pointer-events-none transition-opacity duration-800 z-40"></div>
  
  <!-- 最终选择框容器 (初始隐藏) -->
  <div id="final-choice-container" class="fixed inset-0 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-1000">
    <div class="w-full max-w-md p-6 bg-terminal border-2 border-glow pulse-soft" style="border-radius: 0;">
      <div class="mb-2 pb-2 border-b border-glitch/30">
        <h2 class="text-glitch text-shadow-glitch text-lg">连接请求</h2>
        <p class="text-xs text-glitch/80">未知设备 #7391 正在尝试建立连接</p>
      </div>
      
      <div class="my-4">
        <p class="text-sm mb-3">检测到来自未知节点的加密信号。</p>
        <p class="text-sm mb-3">同意连接将导致系统权限完全暴露，可能引发数据泄露和系统崩溃。</p>
        <p class="text-sm mb-3">请立即终止操作，否则一切后果由用户自行承担。是否取消操作？</p>
        <p class="text-sm text-danger text-shadow-danger">警告：任何操作都将导致不可逆转的系统风险</p>
      </div>
      
      <div class="flex justify-between mt-6" style="gap: 1rem;">
        <div class="flex-1 relative">
          <button id="reject-btn" class="w-full px-4 py-2 bg-danger/20 border border-danger text-danger hover:bg-danger/30 transition-colors">
            <i class="fa fa-times mr-2"></i>拒绝连接
          </button>
          <span id="failure-text" class="absolute -bottom-5 left-0 right-0 text-center text-danger text-xs opacity-0">operation failure</span>
        </div>
        <div class="flex-1 relative">
          <button id="accept-btn" class="w-full px-4 py-2 bg-glow/20 border border-glow text-glitch hover:bg-glow/30 transition-colors">
            <i class="fa fa-check mr-2"></i>允许访问
          </button>
          <span id="good-kid" class="absolute -bottom-5 left-0 right-0 text-center text-glitch text-xs opacity-0">好孩子:)</span>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 大型聊天框信息 (初始隐藏) -->
  <div id="chat-box" class="fixed inset-0 flex items-center justify-center z-60 opacity-0 pointer-events-none transition-all duration-1000 transform scale-90">
    <div class="w-full max-w-2xl h-[70vh] bg-terminal border-2 border-glow" style="border-radius: 0;">
      <div class="p-4 border-b border-glitch/30 bg-dark flex justify-between items-center">
        <h2 class="text-glitch text-shadow-glitch">unidentified</h2>
        <span class="text-xs text-danger breath-effect">已建立连接 - 警告：数据传输中</span>
      </div>
      <div class="p-4 h-[calc(100%-100px)] overflow-y-auto" id="chat-messages" style="scrollbar-width: none; -ms-overflow-style: none;">
        <!-- 聊天信息将动态添加到这里 -->
      </div>
      <div class="p-4 border-t border-glitch/30 bg-dark">
        <div class="flex gap-2">
          <input type="text" id="message-input" placeholder="输入消息..." class="flex-1 bg-terminal border border-glitch/50 p-2 text-sm focus:outline-none focus:border-glitch" style="border-radius: 0;">
          <button id="send-btn" class="px-4 py-2 bg-glow/20 border border-glow text-glitch">发送</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 核心交互脚本 - 放在body底部确保能找到元素 -->
  <script>
    // 最基础的原生JS实现，避免任何可能的框架冲突
    (function() {
      // 等待页面完全加载
      window.onload = function() {
        // 直接通过ID获取继续按钮 - 最直接的方式
        var continueBtn = document.getElementById('continue-btn');
        var initialWindow = document.getElementById('initial-window');
        var popupSound = document.getElementById('popup-sound');
        var audioInitiated = false;
        
        // 验证按钮是否存在
        if (!continueBtn) {
          alert('继续按钮未找到！请检查HTML结构');
          return;
        }
        
        // 给按钮添加点击事件 - 使用最基础的方式
        continueBtn.onclick = function() {
          // 播放音效获取权限
          if (popupSound) {
            popupSound.currentTime = 0;
            popupSound.volume = 0.3;
            try {
              popupSound.play().then(function() {
                audioInitiated = true;
              }).catch(function(e) {
                console.log('音效播放失败:', e);
                audioInitiated = false;
              });
            } catch (e) {
              console.log('音效播放异常:', e);
            }
          }
          
          // 关闭初始窗口
          if (initialWindow) {
            initialWindow.style.opacity = '0';
            initialWindow.style.transition = 'opacity 0.3s ease';
            
            // 移除窗口
            setTimeout(function() {
              initialWindow.style.display = 'none';
              
              // 停顿3秒后开始主效果
              setTimeout(startMainEffects, 3000);
            }, 300);
          }
        };
        
        // 确保鼠标悬停时显示指针
        continueBtn.style.cursor = 'pointer';
        
        // 为了确保可点击，添加一个视觉反馈
        continueBtn.onmouseover = function() {
          this.style.backgroundColor = 'rgba(0,255,157,0.3)';
        };
        
        continueBtn.onmouseout = function() {
          this.style.backgroundColor = 'rgba(0,255,157,0.2)';
        };
      };
      
      // 开始主效果函数
      function startMainEffects() {
        // 弹窗总数：80-100个
        const totalPopups = 80 + Math.floor(Math.random() * 21);
        const popups = [];
        
        // 第一个弹窗立即出现
        const firstPopup = createWarningPopup(0);
        popups.push(firstPopup);
        
        // 第一个弹窗出现后停顿2秒，再继续后续弹窗
        setTimeout(() => {
          // 第一阶段：接下来9个弹窗，间隔500ms
          for (let i = 1; i < 10; i++) {
            setTimeout(() => {
              const popup = createWarningPopup(i);
              popups.push(popup);
            }, i * 500);
          }
          
          // 第二阶段：接下来20个弹窗，间隔200ms
          for (let i = 10; i < 30; i++) {
            setTimeout(() => {
              const popup = createWarningPopup(i);
              popups.push(popup);
            }, 10 * 500 + (i - 10) * 200);
          }
          
          // 第三阶段：剩余弹窗
          for (let i = 30; i < totalPopups; i++) {
            const delayMultiplier = 35;
            setTimeout(() => {
              const popup = createWarningPopup(i);
              popups.push(popup);
            }, 10 * 500 + 20 * 200 + (i - 30) * delayMultiplier);
          }
          
          // 所有弹窗显示完成后，停顿3秒，然后开始关闭
          const totalPopupTime = 10 * 500 + 20 * 200 + (totalPopups - 30) * 35;
          setTimeout(() => {
            const crtOverlay = document.getElementById('crt-overlay');
            
            // 为所有弹窗添加CRT关闭动画
            popups.forEach(popup => {
              popup.classList.add('crt-shutdown');
            });
            
            // 同时激活CRT覆盖层效果
            setTimeout(() => {
              crtOverlay.style.opacity = 0.7;
            }, 300);
            
            // 动画结束后清理并显示选择框
            setTimeout(() => {
              const container = document.getElementById('popup-container');
              container.innerHTML = '';
              crtOverlay.style.opacity = 0;
              
              // 显示最终选择框
              const choiceContainer = document.getElementById('final-choice-container');
              choiceContainer.style.opacity = 1;
              choiceContainer.style.pointerEvents = 'auto';
            }, 1800);
          }, totalPopupTime + 3000);
        }, 2000);
      }
      
      // 创建警告弹窗
      function createWarningPopup(index) {
        const popupTypes = [
          { title: "未授权访问", message: "检测到异常接入点\nIP: 192.168.XXX.XXX\n正在追踪来源...", icon: "fa-exclamation-triangle", color: "glitch" },
          { title: "系统侵入", message: "防火墙已被突破\n安全协议失效\n数据正在泄露...", icon: "fa-shield", color: "danger" },
          { title: "错误 #404", message: "文件不存在\n数据损坏\n无法恢复", icon: "fa-times-circle", color: "glitch" },
          { title: "警告", message: "监控已激活\n所有操作被记录\n无法逃脱", icon: "fa-eye", color: "danger" },
          { title: "异常活动", message: "检测到未知进程\n内存占用率 99%\n系统即将崩溃", icon: "fa-bolt", color: "glitch" }
        ];
        
        const type = popupTypes[Math.floor(Math.random() * popupTypes.length)];
        const zIndex = 10 + Math.floor(Math.random() * 40);
        const popup = document.createElement('div');
        popup.className = `absolute bg-terminal border border-${type.color}/50 transition-all duration-300 z-${zIndex}`;
        popup.style.width = `${200 + Math.random() * 150}px`;
        popup.style.opacity = 0.7 + Math.random() * 0.3;
        
        popup.innerHTML = `
          <div class="bg-dark px-3 py-1.5 flex justify-between items-center text-xs border-b border-${type.color}/30">
            <span class="text-${type.color} text-shadow-${type.color}">${type.title}</span>
            <div class="flex space-x-1">
              <div class="w-2 h-2 rounded-full bg-${type.color}/50"></div>
              <div class="w-2 h-2 rounded-full bg-${type.color}/50"></div>
              <div class="w-2 h-2 rounded-full bg-${type.color}/50"></div>
            </div>
          </div>
          <div class="p-3">
            <div class="flex items-start mb-2">
              <i class="fa ${type.icon} text-${type.color} mr-2 mt-0.5"></i>
              <p class="text-xs whitespace-pre-line">${type.message}</p>
            </div>
            <div class="flex justify-end space-x-2 mt-3">
              <button class="bg-dark px-2 py-1 text-xs border border-${type.color}/30 text-${type.color}/80">取消</button>
              <button class="bg-${type.color}/20 px-2 py-1 text-xs border border-${type.color}/50 text-${type.color}">确认</button>
            </div>
          </div>
        `;
        
        document.getElementById('popup-container').appendChild(popup);
        
        const container = document.getElementById('popup-container');
        const maxX = container.offsetWidth - popup.offsetWidth;
        const maxY = container.offsetHeight - popup.offsetHeight;
        const x = Math.max(0, Math.floor(Math.random() * maxX));
        const y = Math.max(0, Math.floor(Math.random() * maxY));
        popup.style.left = `${x}px`;
        popup.style.top = `${y}px`;
        
        if (Math.random() > 0.6) popup.classList.add('tv-flicker');
        
        // 播放弹窗音效
        const popupSound = document.getElementById('popup-sound');
        if (popupSound && window.audioInitiated) {
          popupSound.currentTime = 0;
          popupSound.volume = 0.3;
          popupSound.play().catch(e => console.log('音效播放失败:', e));
        }
        
        return popup;
      }
      
      // 其他原有功能（聊天消息等）保持不变
      // ...
    })();
  </script>
</body>
</html>
