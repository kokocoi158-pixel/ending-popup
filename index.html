<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UNKNOWN NODE COMMUNICATION CHANNEL</title>
  <!-- 引入外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            glitch: '#00ff9d',
            danger: '#ff0066',
            dark: '#0a0a0a',
            darker: '#050505',
            terminal: '#0f1912'
          },
          fontFamily: {
            mono: ['Courier New', 'monospace'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow-glitch {
        text-shadow: 0 0 5px theme('colors.glitch'), 
                     0 0 10px theme('colors.glitch/70');
      }
      .text-shadow-danger {
        text-shadow: 0 0 5px theme('colors.danger'), 
                     0 0 10px theme('colors.danger/70');
      }
      .border-glow {
        box-shadow: 0 0 5px theme('colors.glitch'),
                    0 0 10px theme('colors.glitch/50');
      }
      .scanline {
        background: linear-gradient(to bottom, 
                    rgba(255,255,255,0) 0%,
                    rgba(255,255,255,0.2) 50%,
                    rgba(255,255,255,0) 100%);
        position: absolute;
        width: 100%;
        height: 6px;
        animation: scan 2s linear infinite;
      }
      .tv-flicker {
        animation: tvFlicker 0.1s infinite alternate;
      }
      .fade-out {
        animation: fadeOut 0.3s forwards;
      }
      .fade-out-slow {
        animation: fadeOut 0.8s forwards;
      }
      .crt-shutdown {
        animation: crtShutdown 1.8s forwards;
      }
      .fade-in {
        animation: fadeIn 0.5s forwards;
      }
      .pulse-soft {
        animation: pulseSoft 2s infinite alternate;
      }
      .breath-effect {
        animation: breath 2s infinite alternate;
      }
      .static-overlay {
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.3'/%3E%3C/svg%3E");
        background-repeat: repeat;
      }
      .button-shake {
        animation: buttonShake 0.5s cubic-bezier(.36,.07,.19,.97) both;
      }
      .text-fade-in {
        animation: textFadeIn 0.5s forwards;
      }
      .message-appear {
        animation: messageAppear 0.6s forwards;
      }
    }
    
    /* 动画关键帧定义 */
    @keyframes scan {
      0% { top: -10%; }
      100% { top: 100%; }
    }
    
    @keyframes tvFlicker {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
      70% { opacity: 0.9; }
      90% { opacity: 0.6; }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; transform: scale(1); }
      to { opacity: 0; transform: scale(0.8); }
    }
    
    @keyframes crtShutdown {
      0% { 
        opacity: 1; 
        transform: scale(1);
        filter: brightness(1);
      }
      50% { 
        opacity: 0.8;
        filter: brightness(1.2);
      }
      100% { 
        opacity: 0; 
        transform: scale(0.95);
        filter: brightness(0) blur(2px);
      }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    
    @keyframes pulseSoft {
      from { box-shadow: 0 0 10px theme('colors.glitch/50'); }
      to { box-shadow: 0 0 20px theme('colors.glitch/80'); }
    }
    
    @keyframes breath {
      from { opacity: 0.6; text-shadow: 0 0 5px theme('colors.danger/50'); }
      to { opacity: 1; text-shadow: 0 0 10px theme('colors.danger'); }
    }
    
    @keyframes buttonShake {
      10%, 90% { transform: translateX(-1px); }
      20%, 80% { transform: translateX(2px); }
      30%, 50%, 70% { transform: translateX(-3px); }
      40%, 60% { transform: translateX(3px); }
    }
    
    @keyframes textFadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes messageAppear {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="bg-black min-h-screen overflow-hidden font-mono text-glitch relative">
  <!-- 初始交互窗口 -->
  <div id="initial-window" class="fixed inset-0 flex items-center justify-center z-100 bg-black/80">
    <div class="w-full max-w-md p-6 bg-terminal border-2 border-glow pulse-soft" style="border-radius: 0;">
      <div class="mb-2 pb-2 border-b border-glitch/30">
        <h2 class="text-glitch text-shadow-glitch text-lg">系统启动</h2>
        <p class="text-xs text-glitch/80">初始化程序 #001</p>
      </div>
      
      <div class="my-8 h-24"></div>
      
      <div class="flex justify-between mt-6" style="gap: 1rem;">
        <button id="back-btn" class="flex-1 px-4 py-2 bg-danger/20 border border-danger text-danger hover:bg-danger/30 transition-colors" style="border-radius: 0;">
          <i class="fa fa-arrow-left mr-2"></i>返回
        </button>
        <button id="continue-btn" class="flex-1 px-4 py-2 bg-glow/20 border border-glow text-glitch hover:bg-glow/30 transition-colors" style="border-radius: 0;">
          <i class="fa fa-arrow-right mr-2"></i>继续
        </button>
      </div>
    </div>
  </div>

  <!-- 音频元素 -->
  <audio id="long-sound" preload="auto">
    <source src="https://raw.githubusercontent.com/kokocoi158-pixel/ending-popup/refs/heads/main/%E5%BC%B9%E7%AA%97.mp3" type="audio/mpeg">
    您的浏览器不支持音频元素。
   ></audio>
  
  <audio id="close-popup-sound" preload="auto">
    <source src="https://raw.githubusercontent.com/kokocoi158-pixel/ending-popup/refs/heads/main/a_computer_pop-up_wi-1760803508255.mp3" type="audio/mpeg">
    您的浏览器不支持音频元素。
   > </audio>
   
  <!-- 连接请求弹框音效元素 -->
  <audio id="connection-request-sound" preload="auto" volume="0.1">
    <source src="https://raw.githubusercontent.com/kokocoi158-pixel/ending-popup/refs/heads/main/%E9%93%BE%E6%8E%A5%E8%AF%B7%E6%B1%82.mp3" type="audio/mpeg">
    您的浏览器不支持音频元素。
   > </audio>
  
  <!-- 错误选择（拒绝连接）音效元素 -->
  <audio id="error-selection-sound" preload="auto" volume="0.04">
    <source src="https://raw.githubusercontent.com/kokocoi158-pixel/ending-popup/refs/heads/main/%E9%94%99%E8%AF%AF%E9%80%89%E9%A1%B9.mp3" type="audio/mpeg">
    您的浏览器不支持音频元素。
   > </audio>
  
  <!-- 正确选择（允许访问）音效元素 -->
  <audio id="correct-selection-sound" preload="auto" volume="0.05">
    <source src="https://raw.githubusercontent.com/kokocoi158-pixel/ending-popup/refs/heads/main/%E6%AD%A3%E7%A1%AE%E9%80%89%E9%A1%B9.mp3" type="audio/mpeg">
    您的浏览器不支持音频元素。
   > </audio>
  
  <!-- 信息接收音效元素（使用稳定链接） -->
  <audio id="message-receive-sound" preload="auto" volume="0.3">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-message-alert-tone-2870.mp3" type="audio/mpeg">
    您的浏览器不支持音频元素。
   > </audio>
  
  <!-- 视觉效果元素 -->
  <div class="scanline"></div>
  <div class="scanline" style="animation-delay: 0.5s;"></div>
  <div class="scanline" style="animation-delay: 1s;"></div>
  
  <div class="fixed inset-0 static-overlay pointer-events-none tv-flicker"></div>
  <div class="fixed inset-0 bg-gradient-to-b from-black/30 via-transparent to-black/60 pointer-events-none"></div>
  
  <!-- 弹窗容器 -->
  <div id="popup-container" class="relative w-full h-screen"></div>
  
  <!-- CRT关闭效果覆盖层 -->
  <div id="crt-overlay" class="fixed inset-0 bg-black opacity-0 pointer-events-none transition-opacity duration-800 z-40"></div>
  
  <!-- 最终选择框容器 -->
  <div id="final-choice-container" class="fixed inset-0 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-1000">
    <div class="w-full max-w-md p-6 bg-terminal border-2 border-glow pulse-soft" style="border-radius: 0;">
      <div class="mb-2 pb-2 border-b border-glitch/30">
        <h2 class="text-glitch text-shadow-glitch text-lg">连接请求</h2>
        <p class="text-xs text-glitch/80">未知设备 #7391 正在尝试建立连接</p>
      </div>
      
      <div class="my-4">
        <p class="text-sm mb-3">检测到来自未知节点的加密信号。</p>
        <p class="text-sm mb-3">同意连接将导致系统权限完全暴露，可能引发数据泄露和系统崩溃。</p>
        <p class="text-sm mb-3">请立即终止操作，否则一切后果由用户自行承担。是否继续操作？</p>
        <p class="text-sm text-danger text-shadow-danger">警告：任何操作都将导致不可逆转的系统风险</p>
      </div>
      
      <div class="flex justify-between mt-6" style="gap: 1rem;">
        <div class="flex-1 relative">
          <button id="reject-btn" class="w-full px-4 py-2 bg-danger/20 border border-danger text-danger hover:bg-danger/30 transition-colors" style="border-radius: 0;">
            <i class="fa fa-times mr-2"></i>拒绝连接
          </button>
          <span id="failure-text" class="absolute -bottom-5 left-0 right-0 text-center text-danger text-xs opacity-0">operation failure</span>
        </div>
        <div class="flex-1 relative">
          <button id="accept-btn" class="w-full px-4 py-2 bg-glow/20 border border-glow text-glitch hover:bg-glow/30 transition-colors" style="border-radius: 0;">
            <i class="fa fa-check mr-2"></i>允许访问
          </button>
          <span id="good-kid" class="absolute -bottom-5 left-0 right-0 text-center text-glitch text-xs opacity-0">好孩子:)</span>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 大型聊天框 -->
  <div id="chat-box" class="fixed inset-0 flex items-center justify-center z-60 opacity-0 pointer-events-none transition-all duration-1000 transform scale-90">
    <div class="w-full max-w-2xl h-[70vh] bg-terminal border-2 border-glitch" style="border-radius: 0;">
      <div class="p-4 border-b border-glitch/30 bg-dark flex justify-between items-center">
        <h2 class="text-glitch text-shadow-glitch">unidentified</h2>
        <span class="text-xs text-danger breath-effect">已建立连接 - 警告：数据传输中</span>
      </div>
      <div class="p-4 h-[calc(100%-100px)] overflow-y-auto" id="chat-messages" style="scrollbar-width: none; -ms-overflow-style: none;"></div>
      <div class="p-4 border-t border-glitch/30 bg-dark">
        <div class="flex gap-2">
          <input type="text" id="message-input" placeholder="输入消息..." class="flex-1 bg-terminal border border-glitch/50 p-2 text-sm focus:outline-none focus:border-glitch" style="border-radius: 0;">
          <button id="send-btn" class="px-4 py-2 bg-glow/20 border border-glow text-glitch" style="border-radius: 0;">发送</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 音频配置
    const AUDIO_VOLUMES = {
      long: 0.3,                // 第一段音效音量
      closePopup: 0.05,          // 第二段音效音量
      connectionRequest: 0.1,    // 连接请求音效音量
      errorSelection: 0.04,      // 错误选择音效音量
      correctSelection: 0.05,    // 正确选择音效音量
      messageReceive: 0.3        // 信息接收音效音量（提高音量确保可闻）
    };
    
    // 音频上下文与状态管理
    let audioContext;
    let soundPlayed = false;
    let closeSoundPlayed = false;
    let connectionSoundPlayed = false;
    
    // 初始化音频上下文并设置音量
    function initAudio() {
      // 获取音频元素
      const longSound = document.getElementById('long-sound');
      const closeSound = document.getElementById('close-popup-sound');
      const connectionSound = document.getElementById('connection-request-sound');
      const errorSound = document.getElementById('error-selection-sound');
      const correctSound = document.getElementById('correct-selection-sound');
      const messageSound = document.getElementById('message-receive-sound');
      
      // 使用JavaScript强制设置音量
      longSound.volume = AUDIO_V
